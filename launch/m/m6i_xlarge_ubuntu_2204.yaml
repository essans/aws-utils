# COPY THIS IF UPDATING INSTANCETYPE, OS VERSION OR VOLUME SIZE !
# aws ec2 run-instances --generate-cli-skeleton > skeleton.json

# attributes to confirm or update (Notes section is ignored by AWS):
#   > TagSpecification --> names for instance and volume
#   > ImageId [run ec2_images_Ubuntu server 22 to find]
#   > InstanceType [run ec2_specs <pattern> <vcpus_filter> for example to find]
#   > KeyName --> update if needed
#   > VolumeSize --> update if needed
#   > IMPORTANT: NetworkInterfaces: SubnetId
#   > IMPORTANT: NetworkInterfaces: Groups

#aws ec2 describe-instance-types \
#  --instance-types m6i.xlarge \
#  --query 'InstanceTypes[0].VCpuInfo.{DefaultThreadsPerCore:DefaultThreadsPerCore, Valid:ValidThreadsPerCore}'


Notes:
  - instanceFamily: m6i
    vCPUs: 4
    # choose one of:
    cpuCores/threads: A) 2 cores x 2 threads (SMT on)  OR  B) 4 cores x 1 thread (SMT off)
    memory(MiB): 16384
    netPerf: Up to 12.5 Gigabit
    ebsBWMbps: ~1000+
    usdPHr: 0.192

TagSpecifications:
  - ResourceType: instance
    Tags:
      - Key: Name
        Value: ec2_node
  - ResourceType: volume
    Tags:
      - Key: Name
        Value: ec2_node

ImageId: ami-0bbdd8c17ed981ef9
InstanceType: m6i.xlarge
KeyName: default_ed25519
MinCount: 1
MaxCount: 1

IamInstanceProfile:
  Name: AWSCloud9SSMInstanceProfile

# ----- A) SMT ON (2 cores x 2 threads = 4 vCPUs) -----
CpuOptions:
  CoreCount: 2
  ThreadsPerCore: 2

# ----- B) SMT OFF (4 cores x 1 thread = 4 vCPUs) -----
# CpuOptions:
#   CoreCount: 4
#   ThreadsPerCore: 1

BlockDeviceMappings:
  - DeviceName: /dev/sda1
    Ebs:
      DeleteOnTermination: true
      Encrypted: false
      Iops: 3000
      VolumeSize: 125
      VolumeType: gp3
      Throughput: 125

NetworkInterfaces:
  - SubnetId: subnet-040c41a8375fb03fa
    AssociatePublicIpAddress: true
    DeleteOnTermination: true
    DeviceIndex: 0
    Groups:
      - sg-0c1f8430a8cf53bec

InstanceInitiatedShutdownBehavior: stop

MetadataOptions:
  HttpEndpoint: enabled
  HttpPutResponseHopLimit: 2
  HttpTokens: required
  InstanceMetadataTags: enabled

PrivateDnsNameOptions:
  HostnameType: ip-name
  EnableResourceNameDnsARecord: false
  EnableResourceNameDnsAAAARecord: false